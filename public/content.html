<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <title>DurBiraz - KeÅŸfet</title>
     <link href="content.css" rel="stylesheet">
    
</head>

<body>
    <div class="explore-title">ğŸ§­ KeÅŸfet</div>
    <button class="btn logout" onclick="logout()">Ã‡Ä±kÄ±ÅŸ Yap</button>

    <h1 id="welcome">DurBirazâ€™a HoÅŸ Geldin</h1>

    <div class="container">
        <div id="postsContainer"></div>
    </div>

    <div class="input-area">
        <textarea id="messageInput" rows="2" placeholder="BugÃ¼n ne hissediyorsun?"></textarea>
        <input type="file" id="photoInput" accept="image/*" style="display: none;" />
        <button class="btn file-btn" onclick="document.getElementById('photoInput').click()">ğŸ“· FotoÄŸraf Ekle</button>
        <span id="fileName" class="file-name">Dosya seÃ§ilmedi</span>

        <button class="btn" onclick="submitMessage()">YayÄ±nla</button>
    </div>


    <script>
        const name = localStorage.getItem("userName") || "Anonim";
        const feeling = localStorage.getItem("userFeeling") || "ğŸ™‚";

        document.getElementById("welcome").innerText = `DurBirazâ€™a HoÅŸ Geldin, ${name}`;

        function logout() {
            localStorage.removeItem("userName");
            window.location.href = "/login.html";
        }

        function submitMessage() {
            const input = document.getElementById("messageInput");
            const fileInput = document.getElementById("photoInput");
            const message = input.value.trim();
            const photo = fileInput.files[0];

            if (!message && !photo) return alert("LÃ¼tfen bir mesaj veya fotoÄŸraf ekleyin.");

            const formData = new FormData();
            formData.append("name", name);
            formData.append("feeling", feeling);
            formData.append("message", message);
            if (photo) {
                formData.append("photo", photo);
            }

            fetch("/messages", {
                method: "POST",
                body: formData,
            })
                .then(res => res.text())
                .then(() => {
                    input.value = "";
                    fileInput.value = "";
                    fetchMessages();
                });
        }


        function getFeelingIcon(feeling) {
            switch (feeling) {
                case "mutlu": return "ğŸ˜Š";
                case "Ã¼zgÃ¼n": return "ğŸ˜¢";
                case "kÄ±zgÄ±n": return "ğŸ˜ ";
                case "yorgun": return "ğŸ˜´";
                case "heyecanlÄ±": return "ğŸ˜„";
                default: return "ğŸ™‚";
            }
        }

        function addPost(username, message, feeling, date, photo) {
            const postsContainer = document.getElementById("postsContainer");

            const card = document.createElement("div");
            card.className = "post-card";

            let photoHTML = "";
            if (photo) {
                photoHTML = `<img src="${photo}" alt="GÃ¶nderi gÃ¶rseli" style="width:100%; max-height:300px; object-fit:cover; margin-top:10px;" />`;
            }

            card.innerHTML = `
        <div class="post-header">
            <span>${getFeelingIcon(feeling)} ${feeling}</span>
            <span>@${username}</span>
        </div>
        <div class="post-message">${message}</div>
        ${photoHTML}
        <div class="post-footer">${date}</div>
    `;

            postsContainer.prepend(card);
        }




        function fetchMessages() {
            fetch("/messages")
                .then(res => res.json())
                .then(messages => {
                    const container = document.getElementById("postsContainer");
                    container.innerHTML = "";
                    messages.forEach(msg => {
                        addPost(msg.name, msg.message, msg.feeling, msg.date, msg.photo);
                    });


                });
        }

        window.addEventListener("load", () => {
            fetchMessages(); // Ä°lk yÃ¼klemede getir
            setInterval(fetchMessages, 1000); // 5 saniyede bir gÃ¼ncelle
        });
    </script>
</body>

</html>